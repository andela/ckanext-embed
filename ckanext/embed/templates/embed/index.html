{% extends "embed/base.html" %}

{% block content %}

    <div class="row">
      <div class="col">
        <form method="get">
          <div class="input-group">
            <input type="hidden" id="organization" name="organization" value="">
            <input type="text" class="form-control" name="q" autocomplete="off" placeholder="Search for datasets" aria-label="Search for datasets">
            <span class="input-group-btn">
              <button class="btn btn-secondary" type="submit" value="Search"> Search </button>
            </span>
            <span class="input-group-btn">
                <button class="btn btn-secondary" type="submit" value="Search"> Back </button>
            </span>
          </div>
        </form>
      </div>
    </div>

    <div class="row">

      <div id="accordion" class="col" role="tablist" aria-multiselectable="true">
        {% set heading = 1 %}
        {% set collapse = 1 %}
        
        {% if datasets|length >= 1 %}

            {{ datasets|length }} found.

            {% for dataset in datasets %}
              <div class="card">
                <div class="card-header" role="tab" id="heading{{ heading }}">
                  <h5 class="mb-0">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse{{ collapse }}" aria-expanded="true" aria-controls="collapse{{ collapse }}">
                      {{ dataset.title }}
                    </a>
                  </h5>
                </div>
            
            
                <div id="collapse{{ collapse }}" class="collapse show" role="tabpanel" aria-labelledby="heading{{ heading }}">
                  <div class="card-block">
                    {% if dataset.notes %}
                      {{ dataset.notes }} <br> <br>
                    {% else %}
                      <i>This dataset has no description</i> <br> <br>
                    {% endif %}

                    <a href="/embed/dataset/{{ dataset.id }}"> View </a> <br>
                    {% for resource in dataset.resources %}
                      <a href="/embed/dataset/{{ dataset.id }}" class="label" data-format="{{ resource.format }}">{{ resource.format }}</a>
                    {% endfor %}
            
                  </div>
                </div>
              </div>
                {% set heading = heading + 1 %}
                {% set collapse = collapse + 1 %}
            
                {% endfor %}
            
      </div>

        {% else %}

          <h3> No datasets found </h3>
        
        {% endif %}

    </div>

{% endblock %}

{% block script %}
    <script type="text/javascript">
      /*
      Get the organization name from the url set in the iframe
      and set it in the form
      to be used to send the get requests
      */
      (function(){
        var url = new URL(window.location.href);
        var organization = url.searchParams.get("organization");
        document.getElementById('organization').value = organization;
      })();
    </script>
{% endblock %}
